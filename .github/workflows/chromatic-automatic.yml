name: 'Chromatic (automatic)'
on:
    pull_request_review:
        types: [submitted]
    pull_request:
        types: [opened, synchronize, reopened]
jobs:
    # check_approval:
    #     name: Check PR Approvals
    #     uses: ./.github/workflows/pr-approvals.yml
    #     with:
    #         pull-number: ${{ github.event.pull_request.number }}
    #         min-approval-count: 1
    #     secrets:
    #         github-token: ${{ secrets.GITHUB_TOKEN }}
    chromatic:
        name: Run Chromatic
        runs-on: ubuntu-latest
        # needs: check_approval
        # if: needs.check_approval.outputs.is_approved == 'true'
        permissions:
            pull-requests: write
        steps:
            - name: Post results
              uses: actions/github-script@v7
              with:
                  script: |
                      github.rest.issues.createComment({
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        issue_number: context.issue.number,
                        body: 'AUTOMATIC ACTION EXECUTED'
                      })
            # - name: Checkout code
            #   uses: actions/checkout@v4
            #   with:
            #       fetch-depth: 0
            # - name: Setup package manager
            #   uses: pnpm/action-setup@v3
            #   with:
            #       version: 10
            #       run_install: false
            # - name: Setup node
            #   uses: actions/setup-node@v4
            #   with:
            #       node-version: 22.15.0
            #       cache: 'pnpm'
            # - name: Install dependencies
            #   run: pnpm install --frozen-lockfile
            # - name: Run Chromatic
            #   uses: chromaui/action@latest
            #   with:
            #       projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
            #       buildScriptName: 'build:storybook'
            #       onlyChanged: true
            #       zip: true
